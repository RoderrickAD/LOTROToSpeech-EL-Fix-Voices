name: ğŸ”¨ Manuelle EXE-Erstellung (PyInstaller)

# Erlaubt das manuelle Starten des Workflows Ã¼ber die GitHub Actions UI.
on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Version Tag (z.B. v3.0.0) fÃ¼r das Release-Asset'
        required: true
        default: 'dev-build'

jobs:
  build-windows-exe:
    runs-on: windows-latest  # Windows-Umgebung fÃ¼r eine Windows-EXE

    steps:
    - name: â¬‡ï¸ Repository auschecken
      uses: actions/checkout@v4
      
    - name: ğŸ Python 3.10 einrichten
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ AbhÃ¤ngigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        # Installiere alle notwendigen Bibliotheken fÃ¼r den Build
        pip install pyinstaller opencv-python mss keyboard pygame requests Pillow 

    - name: ğŸ”¨ EXE mit PyInstaller erstellen
      run: |
        # Die --onefile Option erstellt eine einzelne EXE.
        # --name gibt der EXE den Namen "LOTROVoiceCompanion".
        # --add-data: Die Syntax ';templates' ist fÃ¼r die Einbindung des Ordners 'templates' aus dem Root-Verzeichnis korrekt.
        # Da der Quellcode in V3 liegt, geben wir V3/main.py als Einstiegspunkt an.
        pyinstaller --onefile ^
                    --name "LOTROVoiceCompanion" ^
                    --specpath "build_spec" ^
                    --distpath "build_dist" ^
                    --workpath "build_work" ^
                    --add-data "templates;templates" ^
                    "V3/main.py"
      # Hinweis: Da der Code in V3 liegt, werden die relativen Imports (from .core import...)
      # von PyInstaller korrekt aufgelÃ¶st, da V3/main.py als Paket-Einstiegspunkt behandelt wird.

    - name: ğŸ“ Ordner fÃ¼r Assets erstellen
      run: |
        mkdir assets

    - name: ğŸ“¦ Asset umbenennen und kopieren
      run: |
        # Benenne die erstellte EXE um, um den Tag im Dateinamen zu haben
        $AssetName = "LOTROVoiceCompanion_${{ github.event.inputs.tag_name }}.exe"
        Copy-Item -Path "build_dist\LOTROVoiceCompanion.exe" -Destination "assets\$AssetName"

    - name: â¬†ï¸ EXE als Build-Artefakt hochladen
      uses: actions/upload-artifact@v4
      with:
        name: lotro-voice-companion-exe
        path: assets/
        retention-days: 7  # Speichert das Artefakt fÃ¼r 7 Tage auf GitHub
