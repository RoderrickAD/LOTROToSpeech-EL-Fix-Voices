name: ğŸ”¨ Manuelle EXE-Erstellung (PyInstaller - Spec File)

# Erlaubt das manuelle Starten des Workflows Ã¼ber die GitHub Actions UI.
on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Version Tag (z.B. v3.0.0) fÃ¼r das Release-Asset'
        required: true
        default: 'dev-build' # Standardwert fÃ¼r manuelle Builds

jobs:
  build-windows-exe:
    runs-on: windows-latest

    steps:
    - name: â¬‡ï¸ Repository auschecken
      uses: actions/checkout@v4
      
    - name: ğŸ Python 3.10 einrichten
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ AbhÃ¤ngigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        # Installiere alle notwendigen Bibliotheken fÃ¼r den Build
        pip install pyinstaller opencv-python mss keyboard pygame requests Pillow 

    - name: ğŸ”¨ EXE mit PyInstaller Spec erstellen
      # FÃ¼hrt PyInstaller mit der Spec-Datei aus, was die Shell-Syntax-Fehler umgeht.
      # Der Befehl ist kurz und benÃ¶tigt keine ZeilenumbrÃ¼che.
      run: pyinstaller --onefile "LOTROVoiceCompanion.spec"
      
    - name: ğŸ“ Ordner fÃ¼r Assets erstellen
      run: |
        mkdir assets

    - name: ğŸ“¦ Asset umbenennen und kopieren
      run: |
        # Die erstellte EXE liegt in 'dist'
        $AssetName = "LOTROVoiceCompanion_${{ github.event.inputs.tag_name }}.exe"
        Copy-Item -Path "dist\LOTROVoiceCompanion.exe" -Destination "assets\$AssetName"

    - name: â¬†ï¸ EXE als Build-Artefakt hochladen
      uses: actions/upload-artifact@v4
      with:
        name: lotro-voice-companion-exe
        path: assets/
        retention-days: 7
