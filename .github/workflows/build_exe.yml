name: Python-Build und Release (EXE)

# Steuert, wann die Action ausgef√ºhrt werden soll.
# Dies startet den Workflow, sobald ein neues Release auf GitHub ver√∂ffentlicht wird.
on:
  release:
    types: [published]

jobs:
  build-windows-exe:
    runs-on: windows-latest  # Wir ben√∂tigen eine Windows-Umgebung f√ºr eine Windows-EXE

    steps:
    - name: ‚¨áÔ∏è Repository auschecken
      uses: actions/checkout@v4
      
    - name: üêç Python 3.10 einrichten
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: üì¶ Abh√§ngigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        # Installiere PyInstaller und alle Python-Bibliotheken
        pip install pyinstaller opencv-python mss keyboard pygame requests Pillow 

    - name: üî® EXE mit PyInstaller erstellen
      run: |
        # Die --onefile Option erstellt eine einzelne EXE.
        # --name gibt der EXE den Namen "LOTROVoiceCompanion".
        # --add-data wird ben√∂tigt, um nicht-python-Dateien einzubinden (Templates, Config, etc.)
        # Die Syntax mit ';' ist f√ºr Windows/PyInstaller korrekt.
        pyinstaller --onefile ^
                    --name "LOTROVoiceCompanion" ^
                    --add-data "templates;templates" ^
                    "main.py"
      # Hinweis: Da das Projekt nun in Core, OCR und TTS Services aufgeteilt ist,
      # muss PyInstaller nur main.py als Haupteinstiegspunkt kennen.
      # Es findet die Imports (core, ocr_service, tts_service, utils) automatisch.

    - name: üìÇ Release-Dateien finden und hochladen
      uses: actions/upload-release-asset@v1
      env:
        # GitHub Token wird automatisch von der Action bereitgestellt
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        # Die URL des Releases, das diesen Workflow ausgel√∂st hat
        upload_url: ${{ github.event.release.upload_url }}
        # Pfad zur erstellten EXE-Datei
        asset_path: dist/LOTROVoiceCompanion.exe
        # Name des Assets, wie er im Release angezeigt wird
        asset_name: LOTROVoiceCompanion_${{ github.event.release.tag_name }}.exe
        asset_content_type: application/vnd.microsoft.portable-executable
