name: ğŸ”¨ Manuelle EXE-Erstellung (PyInstaller)

on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Version Tag (z.B. v3.0.0) fÃ¼r das Release-Asset'
        required: true
        default: 'dev-build'

jobs:
  build-windows-exe:
    runs-on: windows-latest

    steps:
    - name: â¬‡ï¸ Repository auschecken
      uses: actions/checkout@v4
      
    - name: ğŸ Python 3.10 einrichten
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ AbhÃ¤ngigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller opencv-python mss keyboard pygame requests Pillow 

    - name: ğŸ”¨ EXE mit PyInstaller erstellen
      # NEU: explizite Angabe der Shell als cmd.exe, um die Windows-Syntax (^) zu erlauben.
      # Dadurch kÃ¶nnen wir den Befehl auch wieder Ã¼bersichtlicher gestalten.
      shell: cmd
      run: |
        pyinstaller --onefile ^
                    --name "LOTROVoiceCompanion" ^
                    --specpath "build_spec" ^
                    --distpath "build_dist" ^
                    --workpath "build_work" ^
                    --add-data "templates;templates" ^
                    "V3/main.py"
      
    - name: ğŸ“ Ordner fÃ¼r Assets erstellen
      run: |
        mkdir assets

    - name: ğŸ“¦ Asset umbenennen und kopieren
      run: |
        # Dieser Schritt lÃ¤uft in PowerShell, aber die Pfade sind Standard
        $AssetName = "LOTROVoiceCompanion_${{ github.event.inputs.tag_name }}.exe"
        Copy-Item -Path "build_dist\LOTROVoiceCompanion.exe" -Destination "assets\$AssetName"

    - name: â¬†ï¸ EXE als Build-Artefakt hochladen
      uses: actions/upload-artifact@v4
      with:
        name: lotro-voice-companion-exe
        path: assets/
        retention-days: 7
