name: ğŸ”¨ Manuelle EXE-Erstellung (PyInstaller)

# Erlaubt das manuelle Starten des Workflows Ã¼ber die GitHub Actions UI.
on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Version Tag (z.B. v3.0.0) fÃ¼r das Release-Asset'
        required: true
        default: 'dev-build'

jobs:
  build-windows-exe:
    runs-on: windows-latest  # Windows-Umgebung fÃ¼r eine Windows-EXE

    steps:
    - name: â¬‡ï¸ Repository auschecken
      uses: actions/checkout@v4
      
    - name: ğŸ Python 3.10 einrichten
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ AbhÃ¤ngigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller opencv-python mss keyboard pygame requests Pillow 

    - name: ğŸ”¨ EXE mit PyInstaller erstellen
      # Durch die einzeilige AusfÃ¼hrung werden Probleme mit PowerShell-ZeilenumbrÃ¼chen (^) vermieden.
      # Wir nutzen die ; Trennung in add-data, da dies die PyInstaller-Standardmethode auf Windows ist.
      run: pyinstaller --onefile --name "LOTROVoiceCompanion" --specpath "build_spec" --distpath "build_dist" --workpath "build_work" --add-data "templates;templates" "V3/main.py"
      
    - name: ğŸ“ Ordner fÃ¼r Assets erstellen
      run: |
        mkdir assets

    - name: ğŸ“¦ Asset umbenennen und kopieren
      run: |
        # Die PowerShell-Variable $AssetName wird gesetzt, um den Tag im Dateinamen zu haben
        $AssetName = "LOTROVoiceCompanion_${{ github.event.inputs.tag_name }}.exe"
        Copy-Item -Path "build_dist\LOTROVoiceCompanion.exe" -Destination "assets\$AssetName"

    - name: â¬†ï¸ EXE als Build-Artefakt hochladen
      uses: actions/upload-artifact@v4
      with:
        name: lotro-voice-companion-exe
        path: assets/
        retention-days: 7
